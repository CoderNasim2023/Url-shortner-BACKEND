# Production multi-stage Dockerfile

FROM node:18-alpine AS deps
WORKDIR /app
COPY package*.json ./
# Install only production deps
RUN npm ci --only=production

# Copy app sources
COPY . .
# Remove dev-only files if needed
RUN npm prune --production || true

FROM node:18-alpine AS runner
WORKDIR /app
# Copy only necessary artifacts
COPY --from=deps /app .
# Use non-root user
USER node
ENV NODE_ENV=production
EXPOSE 3000
CMD ["node", "app.js"]
